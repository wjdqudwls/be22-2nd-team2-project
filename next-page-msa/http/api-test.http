### ===================================================================
### ðŸ“˜ Next Page MSA Integrated Test Suite
### ===================================================================
### ì´ íŒŒì¼ì€ [IntelliJ HTTP Client]ë¥¼ ì‚¬ìš©í•˜ì—¬ MSA í™˜ê²½ì˜ ëª¨ë“  APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
### ëª¨ë“  ìš”ì²­ì€ API Gateway (Port 8000)ë¥¼ ê²½ìœ í•˜ì—¬ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
###
### ðŸ“Œ ì‚¬ì „ ì¤€ë¹„:
### 1. ëª¨ë“  ì„œë¹„ìŠ¤(Config, Eureka, Gateway, Member, Story, Reaction)ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
### 2. 'Run All'ì„ ëˆ„ë¥´ì§€ ë§ê³ , ì‹œë‚˜ë¦¬ì˜¤ ìˆœì„œëŒ€ë¡œ í•˜ë‚˜ì”© ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œìž¥í•©ë‹ˆë‹¤.
###
### ðŸ“Œ ì¸ì¦ íë¦„:
### - 'íšŒì›ê°€ìž…' -> 'ë¡œê·¸ì¸' ì„±ê³µ ì‹œ, JWT í† í°ì´ ìžë™ìœ¼ë¡œ [Global Variable]ì— ì €ìž¥ë©ë‹ˆë‹¤.
### - ì´í›„ 'Authorization: Bearer {{accessToken}}' í—¤ë”ê°€ í¬í•¨ëœ ìš”ì²­ë“¤ì€ ìžë™ìœ¼ë¡œ ì¸ì¦ë©ë‹ˆë‹¤.
### ===================================================================

### ðŸŒ Global Configuration
@gatewayUrl = http://localhost:8000
@contentType = application/json

### ===================================================================
### 1ï¸âƒ£ íšŒì› ê´€ë¦¬ (Member Service)
### ===================================================================

### 1-1. íšŒì›ê°€ìž… (Sign Up)
# @name signup
POST {{gatewayUrl}}/api/auth/signup
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!",
  "userNicknm": "MSAí…ŒìŠ¤í„°"
}

### 1-2. ë¡œê·¸ì¸ (Login) & í† í° ë°œê¸‰
# @name login
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!"
}

> {%
  // ì‘ë‹µì—ì„œ AccessTokenê³¼ RefreshTokenì„ ì¶”ì¶œí•˜ì—¬ ì „ì—­ ë³€ìˆ˜ì— ì €ìž¥
  client.global.set("accessToken", response.body.data.accessToken);
  client.global.set("refreshToken", response.body.data.refreshToken);
  client.log("âœ… ì¸ì¦ í† í°ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤: " + response.body.data.accessToken);
%}

### 1-3. ë‚´ ì •ë³´ ì¡°íšŒ (My Page)
# @name getMyInfo
GET {{gatewayUrl}}/api/members/me
Authorization: Bearer {{accessToken}}


### ===================================================================
### 2ï¸âƒ£ ì†Œì„¤ ì§‘í•„ (Story Service)
### ===================================================================

### 2-1. ì†Œì„¤ ìƒì„± (Create Book)
# @name createBook
POST {{gatewayUrl}}/api/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "title": "MSA ì•„í‚¤í…ì²˜ì˜ ë¹„ë°€",
  "categoryId": "1",
  "maxSequence": 50,
  "firstSentence": "ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ë¶„ë¦¬ëœ ê·¸ë‚ , ìš°ë¦¬ëŠ” Gateway ì•žì— ëª¨ì˜€ë‹¤."
}

> {%
  client.global.set("bookId", response.body.data);
  client.log("ðŸ“˜ ìƒì„±ëœ ì†Œì„¤ ID: " + response.body.data);
%}

### 2-2. ì†Œì„¤ ëª©ë¡ ì¡°íšŒ (List Books)
GET {{gatewayUrl}}/api/books?page=0&size=10&sort=createdAt,desc

### 2-3. ì†Œì„¤ ìƒì„¸ ì¡°íšŒ (Book Detail)
GET {{gatewayUrl}}/api/books/{{bookId}}

### 2-4. ë¬¸ìž¥ ì´ì–´ì“°ê¸° (Append Sentence)
# @name appendSentence
POST {{gatewayUrl}}/api/books/{{bookId}}/sentences
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "íŠ¸ëž˜í”½ì´ í­ì£¼í•´ë„ Circuit Breakerê°€ ìš°ë¦´ ì§€ì¼œì¤„ ê²ƒì´ë‹¤."
}

> {%
  client.global.set("sentenceId", response.body.data);
%}

### 2-5. ë‚´ê°€ ì“´ ë¬¸ìž¥ ì¡°íšŒ (Internal Connection Test)
# ì´ APIëŠ” Story Serviceê°€ Member Serviceë¥¼ Feignìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ ì •ìƒ ë™ìž‘í•¨
GET {{gatewayUrl}}/api/books/mysentences
Authorization: Bearer {{accessToken}}


### ===================================================================
### 3ï¸âƒ£ ë°˜ì‘ ë° íˆ¬í‘œ (Reaction Service)
### ===================================================================

### 3-1. ëŒ“ê¸€ ìž‘ì„± (Add Comment)
POST {{gatewayUrl}}/api/reactions/comments
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "content": "ì •ë§ í¥ë¯¸ì§„ì§„í•œ ì•„í‚¤í…ì²˜ ì´ì•¼ê¸°ë„¤ìš”!"
}

> {%
  client.global.set("commentId", response.body.data);
%}

### 3-2. ì†Œì„¤ ì¢‹ì•„ìš” (Vote Like)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "LIKE"
}

### 3-3. ë¬¸ìž¥ ì‹«ì–´ìš” (Vote Dislike)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "DISLIKE"
}


### ===================================================================
### 4ï¸âƒ£ ê´€ë¦¬ìž ê¸°ëŠ¥ (Admin)
### ===================================================================

### 4-1. ê´€ë¦¬ìž íšŒì›ê°€ìž…
POST {{gatewayUrl}}/api/auth/admin
Content-Type: {{contentType}}

{
  "userEmail": "admin@nextpage.com",
  "userPw": "admin1234!",
  "userNicknm": "ì‹œìŠ¤í…œê´€ë¦¬ìž"
}

### 4-2. ê´€ë¦¬ìž ë¡œê·¸ì¸
# @name adminLogin
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "admin@nextpage.com",
  "userPw": "admin1234!"
}

> {%
  client.global.set("adminToken", response.body.data.accessToken);
%}

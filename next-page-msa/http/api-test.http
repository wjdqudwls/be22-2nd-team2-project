### ===================================================================
### ğŸ“˜ Next Page MSA Integrated Test Suite (Full Coverage)
### ===================================================================
### ì´ íŒŒì¼ì€ [IntelliJ HTTP Client]ë¥¼ ì‚¬ìš©í•˜ì—¬ MSA í™˜ê²½ì˜ ëª¨ë“  APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
### ëª¨ë“  ìš”ì²­ì€ API Gateway (Port 8000)ë¥¼ ê²½ìœ í•˜ì—¬ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
###
### ğŸ“Œ ì‹œë‚˜ë¦¬ì˜¤ íë¦„:
### 1. íšŒì› ê°€ì… ë° ì¸ì¦ (Member)
### 2. ì†Œì„¤ ìƒì„± ë° ê´€ë¦¬ (Story)
### 3. ë°˜ì‘ ë° íˆ¬í‘œ (Reaction)
### 4. ê´€ë¦¬ì ê¸°ëŠ¥ ë° ì‚­ì œ (Admin)
### ===================================================================

### ğŸŒ Global Configuration
@gatewayUrl = http://localhost:8000
@contentType = application/json

### ===================================================================
### 1ï¸âƒ£ íšŒì› ê´€ë¦¬ (Member Service)
### ===================================================================

### 1-1. ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (Check Email)
GET {{gatewayUrl}}/api/auth/check-email?email=msa_tester@example.com

### 1-2. ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ (Check Nickname)
GET {{gatewayUrl}}/api/auth/check-nickname?nickname=MSAí…ŒìŠ¤í„°

### 1-3. íšŒì›ê°€ì… (Sign Up)
# @name signup
POST {{gatewayUrl}}/api/auth/signup
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!",
  "userNicknm": "MSAí…ŒìŠ¤í„°"
}

### 1-4. ë¡œê·¸ì¸ (Login) & í† í° ë°œê¸‰
# @name login
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!"
}

> {%
  // ì‘ë‹µì—ì„œ AccessTokenê³¼ RefreshTokenì„ ì¶”ì¶œí•˜ì—¬ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
  client.global.set("accessToken", response.body.data.accessToken);
  client.global.set("refreshToken", response.body.data.refreshToken); // ì¿ í‚¤ ì™¸ì— í•„ìš”ì‹œ ì‚¬ìš©
  client.log("âœ… ì¸ì¦ í† í°ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤");
%}

### 1-5. í† í° ê°±ì‹  (Refresh Token)
# ì¿ í‚¤ì— ì €ì¥ëœ refreshTokenì´ ìë™ìœ¼ë¡œ ì „ì†¡ë¨
POST {{gatewayUrl}}/api/auth/refresh

### 1-6. ë‚´ ì •ë³´ ì¡°íšŒ (My Page)
GET {{gatewayUrl}}/api/members/me
Authorization: Bearer {{accessToken}}


### ===================================================================
### 2ï¸âƒ£ ì†Œì„¤ ì§‘í•„ ë° ê´€ë¦¬ (Story Service)
### ===================================================================

### 2-1. ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ
GET {{gatewayUrl}}/api/categories

### 2-2. ì†Œì„¤ ìƒì„± (Create Book)
# @name createBook
POST {{gatewayUrl}}/api/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "title": "MSA ì•„í‚¤í…ì²˜ì˜ ë¹„ë°€",
  "categoryId": "THRILLER",
  "maxSequence": 5,
  "firstSentence": "ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ë¶„ë¦¬ëœ ê·¸ë‚ , ìš°ë¦¬ëŠ” Gateway ì•ì— ëª¨ì˜€ë‹¤."
}

> {%
  client.global.set("bookId", response.body.data);
  client.log("ğŸ“˜ ìƒì„±ëœ ì†Œì„¤ ID: " + response.body.data);
%}

### 2-3. ì†Œì„¤ ëª©ë¡ ì¡°íšŒ (List Books)
GET {{gatewayUrl}}/api/books?page=0&size=10&sort=createdAt,desc

### 2-4. ì†Œì„¤ ìƒì„¸ ì¡°íšŒ (Book Detail)
GET {{gatewayUrl}}/api/books/{{bookId}}

### 2-5. ë¬¸ì¥ ì´ì–´ì“°ê¸° (Append Sentence)
# @name appendSentence
POST {{gatewayUrl}}/api/books/{{bookId}}/sentences
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "íŠ¸ë˜í”½ì´ í­ì£¼í•´ë„ Circuit Breakerê°€ ìš°ë¦´ ì§€ì¼œì¤„ ê²ƒì´ë‹¤."
}

> {%
  client.global.set("sentenceId", response.body.data);
%}

### 2-6. ë‚´ê°€ ì“´ ë¬¸ì¥ ì¡°íšŒ
GET {{gatewayUrl}}/api/books/mysentences
Authorization: Bearer {{accessToken}}

### 2-7. ì†Œì„¤ ì œëª© ìˆ˜ì • (Update Title)
PATCH {{gatewayUrl}}/api/books/{{bookId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "title": "MSA ì•„í‚¤í…ì²˜ì˜ ì§„ì‹¤"
}

### 2-8. ë¬¸ì¥ ìˆ˜ì • (Update Sentence)
PATCH {{gatewayUrl}}/api/books/{{bookId}}/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "íŠ¸ë˜í”½ì´ í­ì£¼í•˜ì Circuit Breakerê°€ ì‘ë™í–ˆë‹¤."
}

### ===================================================================
### 3ï¸âƒ£ ë°˜ì‘ ë° íˆ¬í‘œ (Reaction Service)
### ===================================================================

### 3-1. ëŒ“ê¸€ ì‘ì„± (Add Comment)
POST {{gatewayUrl}}/api/reactions/comments
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "content": "ì •ë§ í¥ë¯¸ì§„ì§„í•œ ì•„í‚¤í…ì²˜ ì´ì•¼ê¸°ë„¤ìš”!"
}

> {%
  client.global.set("commentId", response.body.data);
%}

### 3-2. ì†Œì„¤ ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
GET {{gatewayUrl}}/api/reactions/comments/{{bookId}}

### 3-3. ëŒ“ê¸€ ìˆ˜ì • (Update Comment)
PATCH {{gatewayUrl}}/api/reactions/comments/{{commentId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "ìˆ˜ì •ëœ ëŒ“ê¸€ì…ë‹ˆë‹¤: MSAëŠ” ì–´ë µì§€ë§Œ ì¬ë°Œì–´ìš”."
}

### 3-4. ì†Œì„¤ íˆ¬í‘œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
### [ì„¤ëª…] ì¢‹ì•„ìš” -> ì‹«ì–´ìš”(ë³€ê²½) -> ì‹«ì–´ìš”(ì·¨ì†Œ)

# 3-4-1. ì¢‹ì•„ìš” (ìµœì´ˆ)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "LIKE"
}
> {%
  client.test("Book Vote Like", function() {
      client.assert(response.body.data === true, "Vote should be true");
  });
%}

# 3-4-2. ì‹«ì–´ìš” (ë³€ê²½)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "DISLIKE"
}

# 3-4-3. ì‹«ì–´ìš” (ì·¨ì†Œ)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "DISLIKE"
}
> {%
  client.test("Book Vote Cancel", function() {
      client.assert(response.body.data === false, "Vote should be canceled (false)");
  });
%}

### 3-5. ë¬¸ì¥ íˆ¬í‘œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
### [ì„¤ëª…] ì‹«ì–´ìš” -> ì¢‹ì•„ìš”(ë³€ê²½) -> ì¢‹ì•„ìš”(ì·¨ì†Œ)

# 3-5-1. ì‹«ì–´ìš” (ìµœì´ˆ)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "DISLIKE"
}

# 3-5-2. ì¢‹ì•„ìš” (ë³€ê²½)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "LIKE"
}

# 3-5-3. ì¢‹ì•„ìš” (ì·¨ì†Œ)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "LIKE"
}

### 3-6. ëŒ“ê¸€ ì‚­ì œ
DELETE {{gatewayUrl}}/api/reactions/comments/{{commentId}}
Authorization: Bearer {{accessToken}}


### ===================================================================
### 4ï¸âƒ£ ê´€ë¦¬ì ê¸°ëŠ¥ ë° ì •ë¦¬ (Admin & Cleanup)
### ===================================================================

### 4-1. ë¬¸ì¥ ì‚­ì œ (Delete Sentence)
DELETE {{gatewayUrl}}/api/books/{{bookId}}/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}

### 4-2. ì†Œì„¤ ì™„ê²° (Manual Complete) - maxSequence ë„ë‹¬ ì „ ê°•ì œ ì™„ê²°
POST {{gatewayUrl}}/api/books/{{bookId}}/complete
Authorization: Bearer {{accessToken}}

### 4-3. ì†Œì„¤ ì‚­ì œ (Delete Book)
DELETE {{gatewayUrl}}/api/books/{{bookId}}
Authorization: Bearer {{accessToken}}

### 4-4. ê´€ë¦¬ì íšŒì›ê°€ì…
POST {{gatewayUrl}}/api/auth/admin
Content-Type: {{contentType}}

{
  "userEmail": "admin_sys@nextpage.com",
  "userPw": "admin1234!",
  "userNicknm": "í†µí•©ê´€ë¦¬ì"
}

### 4-5. ê´€ë¦¬ì ë¡œê·¸ì¸
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "admin_sys@nextpage.com",
  "userPw": "admin1234!"
}

### 4-6. íšŒì› íƒˆí‡´ (Self Withdraw)
DELETE {{gatewayUrl}}/api/auth/withdraw
Authorization: Bearer {{accessToken}}
